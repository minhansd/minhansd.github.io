{% include base_path %}

{% if post.header.teaser %}
  {% capture teaser %}{{ post.header.teaser }}{% endcapture %}
{% else %}
  {% assign teaser = site.teaser %}
{% endif %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

{% assign kind = post.kind | default: "publication" %}

<div style="display: flex; align-items: flex-start; margin-bottom: 35px;">

  <!-- Image (optional) -->
  <div style="flex: 0 0 380px; margin-right: 25px;">
    {% if post.image and post.image != "" and post.image != "N/A" %}
      <img src="/images/portfolio/{{ post.slug }}/{{ post.image }}"
           style="width: 330px; border-radius: 6px; display:block;" />
    {% elsif post.header.teaser %}
      <img src="{{ post.header.teaser | relative_url }}"
           style="width: 330px; border-radius: 6px; display:block;" />
    {% endif %}
  </div>

  <!-- Text -->
  <div style="min-width: 0; max-width: 680px; font-size: 0.95rem; line-height: 1.25;">

    <h2 style="margin-top: 6px; margin-bottom: 4px; font-size: 1.3rem;">
      {{ title }}
    </h2>

    <!-- Authors / Team -->
    {% assign people = post.authors | default: post.team | default: "" %}
    {% if people != "" and people != "N/A" %}
      {% assign people = people | replace: '"{o}', 'ö' %}
      {% assign people = people | replace: '"{u}', 'ü' %}
      <h3 style="font-weight: normal; margin-top: 4px; margin-bottom: 4px; font-size: 0.95rem;">
        {{ people }}
      </h3>
    {% endif %}

    <!-- Meta line -->
    {% if kind == "publication" %}
      {% assign meta_parts = "" %}
      {% if post.venue and post.venue != "" and post.venue != "N/A" %}
        {% assign meta_parts = meta_parts | append: post.venue %}
      {% endif %}
      {% if post.year and post.year != "" and post.year != "N/A" %}
        {% if meta_parts != "" %}{% assign meta_parts = meta_parts | append: ", " %}{% endif %}
        {% assign meta_parts = meta_parts | append: post.year %}
      {% endif %}
      {% if meta_parts != "" %}
        <h3 style="font-weight: normal; margin-top: 4px; margin-bottom: 4px; font-size: 0.9rem;">
          {{ meta_parts }}
          {% if post.status and post.status != "" and post.status != "N/A" %}
            ({{ post.status }})
          {% endif %}
        </h3>
      {% endif %}
    {% else %}
      {% assign meta_parts = "" %}
      {% if post.role and post.role != "" and post.role != "N/A" %}
        {% assign meta_parts = meta_parts | append: post.role %}
      {% endif %}
      {% if post.org and post.org != "" and post.org != "N/A" %}
        {% if meta_parts != "" %}{% assign meta_parts = meta_parts | append: " · " %}{% endif %}
        {% assign meta_parts = meta_parts | append: post.org %}
      {% endif %}
      {% if post.year %}
        {% if meta_parts != "" %}{% assign meta_parts = meta_parts | append: " · " %}{% endif %}
        {% assign meta_parts = meta_parts | append: post.year %}
      {% endif %}
      <h3 style="font-weight: normal; margin-top: 4px; margin-bottom: 4px; font-size: 0.9rem;">
        {{ meta_parts }}
      </h3>
    {% endif %}

    <!-- Notes (optional) -->
    {% if post.notes and post.notes != "" and post.notes != "N/A" %}
      <h3 style="font-weight: normal; margin-top: 6px; margin-bottom: 0px;">
        {{ post.notes }}
      </h3>
    {% endif %}

    <!-- Description (optional, great for projects) -->
    {% assign desc = post.description | default: post.excerpt | default: "" %}
    {% if desc != "" %}
      <p style="margin-top: 6px; margin-bottom: 0px;">
        {{ desc | markdownify | remove: "<p>" | remove: "</p>" }}
      </p>
    {% endif %}

    <!-- Awards (optional) -->
    {% if post.awards and post.awards != "N/A" and post.awards != "" %}
      {% assign awards = post.awards | split: ", " %}
      {% for award in awards %}
        <h3 style="color: red; margin-top: 6px; margin-bottom: 0px;">
          {{ award }}
        </h3>
      {% endfor %}
    {% endif %}

    <!-- Links row -->
    <div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 8px;">

      {% assign website = post.links_to_website | default: post.website | default: post.demo %}
      {% if website and website != "" and website != "N/A" %}
        <a href="{{ website }}" target="_blank"
          style="background:#1F77B4; color:white; padding:4px 10px; border-radius:6px; font-size:0.85rem; text-decoration:none;"
          onmouseover="this.style.opacity=0.85"
          onmouseout="this.style.opacity=1">
          <b>Website</b>
        </a>
      {% endif %}

      {% assign paper = post.arxiv | default: post.paper %}
      {% if paper and paper != "" and paper != "N/A" %}
        <a href="{{ paper }}" target="_blank"
          style="background:#1F77B4; color:white; padding:4px 10px; border-radius:6px; font-size:0.85rem; text-decoration:none;"
          onmouseover="this.style.opacity=0.85"
          onmouseout="this.style.opacity=1">
          <b>Paper</b>
        </a>
      {% endif %}

      {% assign code_link = post.links_to_code | default: post.code | default: post.repo %}
      {% if code_link and code_link != "" and code_link != "N/A" %}
        <a href="{{ code_link }}" target="_blank"
          style="background:#1F77B4; color:white; padding:4px 10px; border-radius:6px; font-size:0.85rem; text-decoration:none;"
          onmouseover="this.style.opacity=0.85"
          onmouseout="this.style.opacity=1">
          Code
        </a>
      {% endif %}

      {% assign video = post.links_to_video | default: post.video %}
      {% if video and video != "" and video != "N/A" %}
        <a href="{{ video }}" target="_blank"
          style="background:#1F77B4; color:white; padding:4px 10px; border-radius:6px; font-size:0.85rem; text-decoration:none;"
          onmouseover="this.style.opacity=0.85"
          onmouseout="this.style.opacity=1">
          <b>Video</b>
        </a>
      {% endif %}

      {% if post.slides and post.slides != "" and post.slides != "N/A" %}
        <a href="{{ post.slides }}" target="_blank"
          style="background:#1F77B4; color:white; padding:4px 10px; border-radius:6px; font-size:0.85rem; text-decoration:none;"
          onmouseover="this.style.opacity=0.85"
          onmouseout="this.style.opacity=1">
          <b>Slides</b>
        </a>
      {% endif %}

      {% if post.docs and post.docs != "" and post.docs != "N/A" %}
        <a href="{{ post.docs }}" target="_blank"
          style="background:#1F77B4; color:white; padding:4px 10px; border-radius:6px; font-size:0.85rem; text-decoration:none;"
          onmouseover="this.style.opacity=0.85"
          onmouseout="this.style.opacity=1">
          <b>Docs</b>
        </a>
      {% endif %}

    </div>
  </div>
</div>
